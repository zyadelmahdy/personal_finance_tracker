{% extends "base.html" %}
{% load static %}
{% load widget_tweaks %}

{% block title %}Settings{% endblock %}

{% block content %}
<div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8 space-y-10">

  <!-- Profile Section -->
  <section class="bg-white rounded-xl shadow p-6">
    <h2 class="text-xl font-bold mb-4">Profile</h2>
    <form method="post" enctype="multipart/form-data" action="{% url 'settings' %}">
      {% csrf_token %}
      {{ profile_form.non_field_errors }}
      <div class="flex items-center gap-6 mb-4">
        <div>
          {% if user.profile.image %}
            <img src="{{ user.profile.image.url }}" alt="Profile Picture" class="h-20 w-20 rounded-full object-cover border-2 border-gray-200" />
          {% else %}
            <img src="{% static 'finance_tracker_app/images/profile_pic.png' %}" alt="Profile Picture" class="h-20 w-20 rounded-full object-cover border-2 border-gray-200" />
          {% endif %}
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Change Profile Picture</label>
          {% render_field profile_form.image class="block w-full text-sm text-gray-500" %}
        </div>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Username</label>
          {% render_field profile_form.username class="block w-full rounded-md border-gray-300" %}
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
          {% render_field profile_form.email class="block w-full rounded-md border-gray-300" %}
        </div>
      </div>
      <button type="submit" name="profile_submit" class="mt-4 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">Save Profile</button>
    </form>
  </section>

  <!-- Preferences Section -->
  <section class="bg-white rounded-xl shadow p-6">
    <h2 class="text-xl font-bold mb-4">Preferences</h2>
    <form method="post" action="{% url 'settings' %}">
      {% csrf_token %}
      {{ preferences_form.non_field_errors }}
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Currency</label>
          {% render_field preferences_form.currency class="block w-full rounded-md border-gray-300" %}
        </div>
        <!-- Add more preferences fields here if needed -->
      </div>
      <button type="submit" name="preferences_submit" class="mt-4 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">Save Preferences</button>
    </form>
  </section>

  <!-- Security Section -->
  <section class="bg-white rounded-xl shadow p-6">
    <h2 class="text-xl font-bold mb-4">Security</h2>
    <form method="post" action="{% url 'settings' %}">
      {% csrf_token %}
      {{ password_form.non_field_errors }}
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Current Password</label>
          {% render_field password_form.old_password class="block w-full rounded-md border-gray-300" %}
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">New Password</label>
          {% render_field password_form.new_password1 class="block w-full rounded-md border-gray-300" %}
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Confirm New Password</label>
          {% render_field password_form.new_password2 class="block w-full rounded-md border-gray-300" %}
        </div>
      </div>
      <button type="submit" name="password_submit" class="mt-4 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">Change Password</button>
    </form>
  </section>

</div>
{% endblock %}